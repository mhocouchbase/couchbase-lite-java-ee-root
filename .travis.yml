sudo: false

env:
  global:
   - ANDROID_SDK_VERSION=29
   - EMULATOR_API=21
   - EMULATOR_ABI=x86_64
   - ANDROID_BUILD_TOOLS_VERSION=29.0.3
   - ANDROID_ABI=x86_64
   - ADB_INSTALL_TIMEOUT=20 # minutes (2 minutes by default)

matrix:
  include
    - language: android
      dist: trusty
      jdk: oraclejdk8
      android:
        components:
          - tools
          - android-$ANDROID_SDK_VERSION
          - build-tools-$ANDROID_BUILD_TOOLS_VERSION
          - platform-tools
      before_cache:
        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      cache:
        directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
      script:
        - ./gradlew ce:android:ce_android:ciCheck

    - language: android
      dist: trusty
      jdk: oraclejdk8
      android:
        components:
          - tools
          - android-$ANDROID_SDK_VERSION
          - build-tools-$ANDROID_BUILD_TOOLS_VERSION
          - platform-tools
          - sys-img-${EMULATOR_ABI}-addon-google_apis-google-${EMULATOR_API}
      before_script:
        - echo no | android create avd --force -n test -t android-$EMULATOR_API--abi $EMULATOR_ABI
        - emulator -avd test -no-skin -no-audio -no-window &
        - android-wait-for-emulator
        - adb shell input keyevent 82 &
      before_cache:
        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      cache:
        directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
      script:
        - ./gradlew ce:android:ce_android:ciAutomatedTest

    - language: java
      dist: trusty
      jdk: oraclejdk8
      before_cache:
        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      cache:
        directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
      script:
        - ./gradlew ce:java:ce_java:ciCheck

    - language: java:
      dist: trusty
      jdk: oraclejdk8
      before_cache:
        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      cache:
        directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
      script:
        - ./gradlew ce:android:ce_android:ciAutomatedTest





branches:
  only:
    - master


